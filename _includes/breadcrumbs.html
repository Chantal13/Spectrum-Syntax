{%- comment -%}
  Breadcrumbs include
  Usage: included automatically from default layout. Builds crumbs from page.url
  and attempts to resolve titles by matching site.pages and site.notes by URL.
  Fallback: humanize URL segments if no page found.
{%- endcomment -%}

{%- assign url = page.url | default: '/' -%}
{%- assign parts = url | split: '/' -%}

<nav class="breadcrumbs" aria-label="Breadcrumb">

  {%- if page.breadcrumbs and page.breadcrumbs.size > 0 -%}
    {%- for bc in page.breadcrumbs -%}
      {%- unless forloop.first -%}<span class="crumb-sep">›</span>{%- endunless -%}
      <a class="internal-link" href="{{ bc.url }}">{{ bc.title }}</a>
    {%- endfor -%}
    {%- if page.title -%}<span class="crumb-sep">›</span><span aria-current="page">{{ page.title }}</span>{%- endif -%}
  {%- else -%}
    {%- assign accum = '' -%}
    {%- for seg in parts -%}
      {%- if seg == '' -%}
        {%- continue -%}
      {%- endif -%}

      {%- assign accum = accum | append: '/' | append: seg -%}
      {%- assign target = accum | append: '/' -%}
      {%- assign is_last = forloop.last -%}

      {%- assign match = nil -%}
      {%- assign pages = site.pages | where: 'url', target -%}
      {%- if pages and pages.size > 0 -%}
        {%- assign match = pages[0] -%}
      {%- endif -%}
      {%- if match == nil and site.notes -%}
        {%- assign notes = site.notes | where: 'url', target -%}
        {%- if notes and notes.size > 0 -%}
          {%- assign match = notes[0] -%}
        {%- endif -%}
      {%- endif -%}

      {%- assign label = nil -%}
      {%- if match and match.title -%}
        {%- assign label = match.title -%}
      {%- else -%}
        {%- assign label = seg | url_decode | title_case -%}
      {%- endif -%}

      {%- if is_last -%}
        {%- unless forloop.first -%}<span class="crumb-sep">›</span>{%- endunless -%}
        <span aria-current="page">{{ label }}</span>
      {%- else -%}
        {%- unless forloop.first -%}<span class="crumb-sep">›</span>{%- endunless -%}
        <a class="internal-link" href="{{ target }}">{{ label }}</a>
      {%- endif -%}
    {%- endfor -%}
    {%- comment -%}
      Optional explicit parent crumb via front matter (bidirectional-friendly)
      Example:
        parent_title: Quartz
        parent_url:   /rockhounding/rocks/minerals/quartz/
    {%- endcomment -%}
    {%- if page.parent_title and page.parent_url -%}
      <span class="crumb-sep">›</span>
      <a class="internal-link" href="{{ page.parent_url | relative_url }}">{{ page.parent_title }}</a>
      <span class="crumb-sep">›</span>
      <span aria-current="page">{{ page.title }}</span>
    {%- endif -%}
  {%- endif -%}
</nav>
