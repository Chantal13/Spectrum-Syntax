{%- comment -%}
  Global site navigation
  - Appears at the top of every page (default layout)
  - Highlights active section
{%- endcomment -%}

{%- assign url = page.url | default: '/' -%}
{%- assign is_home = page.id == 'home' or url == '/' -%}
{%- assign in_logs = url contains '/logs/' -%}

<nav class="site-nav" role="navigation" aria-label="Primary">
  <a class="internal-link nav-home{% if is_home %} nav-link--active{% endif %}"
     href="/"{% if is_home %} aria-current="page"{% endif %}><strong>{{ site.title }}</strong></a>
  <button class="menu-toggle" aria-expanded="false" aria-controls="site-menu" aria-label="Toggle navigation">Menu</button>
  <button class="theme-toggle" id="theme-toggle" aria-pressed="false" aria-label="Toggle dark mode">ðŸŒ™</button>

  <ul class="nav-links" id="site-menu">
  </ul>
</nav>

<script>
  (function() {
    var nav = document.querySelector('.site-nav');
    if (!nav) return;
    var btn = nav.querySelector('.menu-toggle');
    var menu = nav.querySelector('#site-menu');
    if (!btn || !menu) return;

    btn.addEventListener('click', function() {
      var isOpen = nav.classList.toggle('is-open');
      btn.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
    });

    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        nav.classList.remove('is-open');
        btn.setAttribute('aria-expanded', 'false');
      }
    });

    document.addEventListener('click', function(e) {
      if (!nav.contains(e.target)) {
        nav.classList.remove('is-open');
        btn.setAttribute('aria-expanded', 'false');
      }
    });
  })();

  // Theme toggle (light/dark)
  (function() {
    var btn = document.getElementById('theme-toggle');
    if (!btn) return;

    var root = document.documentElement;
    var storageKey = 'theme';

    function currentTheme() {
      return root.getAttribute('data-theme') || 'light';
    }

    function applyTheme(mode) {
      root.setAttribute('data-theme', mode);
      try { localStorage.setItem(storageKey, mode); } catch (e) {}
      btn.setAttribute('aria-pressed', mode === 'dark' ? 'true' : 'false');
      btn.textContent = mode === 'dark' ? 'â˜€ï¸Ž' : 'ðŸŒ™';
      btn.title = mode === 'dark' ? 'Switch to light mode' : 'Switch to dark mode';
    }

    // Initial: prefer saved, else OS preference
    var saved = null;
    try { saved = localStorage.getItem(storageKey); } catch (e) {}
    if (saved === 'dark' || saved === 'light') {
      applyTheme(saved);
    } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      applyTheme('dark');
    } else {
      applyTheme('light');
    }

    btn.addEventListener('click', function() {
      applyTheme(currentTheme() === 'dark' ? 'light' : 'dark');
    });
  })();
</script>
