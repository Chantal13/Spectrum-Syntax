<!DOCTYPE html>
<html lang="en-CA">
  {% include head.html %}
  <body class="theme-site{% if page.id %} page-{{ page.id | slugify }}{% endif %}" data-gramm="false" data-gramm_editor="false" data-pw-ignore="true">
    {% include site_nav.html %}
    <div class="wrapper">
      {% include breadcrumbs.html %}
      <main>{{ content }}</main>
      <footer>{% include footer.html %}</footer>
    </div>

    {% include link-previews.html wrapperQuerySelector=".page-content" %}
    {% include link-previews.html wrapperQuerySelector=".note-content" %}
    {% include link-previews.html wrapperQuerySelector=".note-aside" %}

    <script>
      // Remove inputs injected by writing-aid browser extensions (e.g., ProWritingAid/Grammarly)
      // that can trigger a11y audits: missing id/name on fake editors.
      (function () {
        function cleanInjectedEditors() {
          var sel = [
            'input[pwa-fake-editor]',
            'textarea[pwa-fake-editor]',
            'input[data-gramm="true"]',
            'textarea[data-gramm="true"]'
          ].join(',');
          document.querySelectorAll(sel).forEach(function (el) {
            try { el.parentNode && el.parentNode.removeChild(el); } catch (e) {}
          });
        }
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', cleanInjectedEditors);
        } else {
          cleanInjectedEditors();
        }
      })();
    </script>
    <script>
      // Convert Obsidian-style callouts into styled callout blocks.
      (function () {
        function titleCase(str) {
          return str.replace(/[-_]+/g, ' ').replace(/\b\w/g, function (c) {
            return c.toUpperCase();
          });
        }

        function enhanceCallouts() {
          document.querySelectorAll('blockquote').forEach(function (bq) {
            var firstP = bq.querySelector('p');
            if (!firstP) return;
            var text = (firstP.textContent || '').trim();
            var match = text.match(/^\[!([A-Za-z]+)\]/);
            if (!match) return;

            var type = match[1].toLowerCase();
            var cleanedHtml = (firstP.innerHTML || '').replace(
              /^\s*\[![A-Za-z]+\]\s*(<br\s*\/?>\s*)?/i,
              ''
            );
            var callout = document.createElement('div');
            callout.className = 'callout callout-' + type;

            var header = document.createElement('div');
            header.className = 'callout-title';
            header.textContent = titleCase(match[1]);
            callout.appendChild(header);

            var body = document.createElement('div');
            body.className = 'callout-body';
            if (cleanedHtml && cleanedHtml.trim()) {
              var p = document.createElement('p');
              p.innerHTML = cleanedHtml;
              body.appendChild(p);
            }

            Array.from(bq.childNodes).forEach(function (node) {
              if (node === firstP) return;
              body.appendChild(node);
            });

            callout.appendChild(body);
            bq.parentNode.replaceChild(callout, bq);
          });
        }

        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', enhanceCallouts);
        } else {
          enhanceCallouts();
        }
      })();
    </script>
  </body>
</html>
