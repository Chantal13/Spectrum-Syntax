---
layout: none
title: Field Log Updater
permalink: /admin/field-log/
---
<!DOCTYPE html>
<html lang="en-CA">
<head>
  <meta charset="UTF-8">
  <title>Field Log Updater</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="robots" content="noindex, nofollow">
  <style>
    :root { --gap: 0.75rem; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; max-width: 100rem; margin: 2rem auto; padding: 0 1rem; }
    h1 { margin: 0 0 .25rem 0; }
    .subtle { color: #666; margin: 0 0 1rem 0; }
    .auth-ok { color: #2e7d32; }
    .auth-fail { color: #c62828; }
    .status { display: inline-flex; align-items: center; gap: .35rem; }
    .status svg { width: 1.1em; height: 1.1em; }
    .bar { display:flex; gap: .75rem; align-items:center; margin: 0 0 1rem 0; flex-wrap: wrap; }
    .bar a { text-decoration: none; }
    .grid-2 { display:grid; grid-template-columns: 1fr 1fr; gap: var(--gap); }
    .grid-3 { display:grid; grid-template-columns: repeat(3, 1fr); gap: var(--gap); }
    label { font-size:.95rem; color:#333; display:block; }
    input[type="text"], input[type="date"], select, textarea { width:100%; box-sizing:border-box; padding:.5rem; border:1px solid #ccc; border-radius:6px; }
    textarea { min-height: 8rem; }
    .actions { display:flex; flex-wrap: wrap; gap:.5rem; margin-top: .75rem; }
    pre { white-space: pre-wrap; background:#f7f7f7; border:1px solid #ddd; padding:.75rem; border-radius:8px; margin-top:.75rem; }
    .note { font-size:.9rem; color:#555; }
    .help { font-size:.85rem; color:#555; margin-top:.35rem; }
    .help summary { font-weight:600; color:#444; cursor:pointer; }
    .help ul { margin:.25rem 0 0 .75rem; padding:0; }
    button { padding:.55rem .8rem; border:1px solid #bbb; background:#fff; border-radius:8px; }
    button:active { transform: translateY(1px); }
    @media (max-width: 900px) { .grid-3 { grid-template-columns: 1fr 1fr; } }
    @media (max-width: 680px) { .grid-2, .grid-3 { grid-template-columns: 1fr; } }
    @media (max-width: 640px) {
      body { margin: 1rem auto; padding: 0 .75rem; }
      .bar { gap: .5rem; }
    }
  </style>
  {% assign css_v = site.time | date: '%s' %}
  <link rel="stylesheet" href="{{ '/styles.css' | relative_url }}?v={{ css_v }}">
</head>
<body>
  <div class="bar">
    <a href="{{ '/admin/' | relative_url }}">← Back to Admin</a>
  </div>
  <p class="subtle" id="auth-status">Checking authentication…</p>

  <h1>Field Log Updater</h1>
  <p class="subtle">Build front matter, extract EXIF GPS, and copy into a new note in <code>_notes/rockhounding/field-log/</code>.</p>

  <p class="note">
    <button type="button" onclick="copyTpl('tpl-field-log')">Copy Field Log Template</button>
  </p>
  <p class="note">
    <a href="https://github.com/Chantal13/Spectrum-Syntax/new/main/_notes/rockhounding/field-log?filename=YYYY-MM-DD-title.md">New file in GitHub</a>
  </p>

  <div class="grid-2">
    <label>Title
      <input id="fld-title" type="text" placeholder="e.g., Granite with Quartz Vein">
    </label>
    <label>Date
      <input id="fld-date" type="date">
    </label>
  </div>

  <div class="grid-2">
    <label>Close-up photo path
      <input id="fld-photo-close" type="text" placeholder="/assets/field/YYYY/close-up.jpg">
    </label>
    <label>Scale photo path (optional)
      <input id="fld-photo-scale" type="text" placeholder="/assets/field/YYYY/with-scale.jpg">
    </label>
  </div>

  <div class="grid-2" style="align-items:end">
    <label>Choose close-up image (camera OK)
      <input id="fld-file-close" type="file" accept="image/*" capture="environment">
    </label>
    <div class="actions">
      <button id="btn-upload-close" type="button">Upload Close-up → assets</button>
      <span id="status-upload-close" class="subtle status"></span>
    </div>
  </div>

  <div class="grid-2" style="align-items:end">
    <label>Choose scale image (optional)
      <input id="fld-file-scale" type="file" accept="image/*" capture="environment">
    </label>
    <div class="actions">
      <button id="btn-upload-scale" type="button">Upload Scale → assets</button>
      <span id="status-upload-scale" class="subtle status"></span>
    </div>
  </div>

  <div class="grid-2" style="align-items:end">
    <label>Pick a photo to read EXIF GPS
      <input id="fld-photo-file" type="file" accept="image/*" capture="environment">
    </label>
    <div class="actions">
      <button type="button" id="btn-exif">Extract GPS</button>
      <span id="exif-status" class="subtle"></span>
    </div>
  </div>
  <div class="grid-2">
    <label>Latitude
      <input id="fld-lat" type="text" placeholder="43.6532">
    </label>
    <label>Longitude
      <input id="fld-lng" type="text" placeholder="-79.3832">
    </label>
  </div>
  <label style="display:block;margin-top:.5rem">Location description
    <input id="fld-loc-desc" type="text" placeholder="Bluffers Park shoreline, Scarborough">
  </label>

  <div class="grid-2">
    <label>Rock type(s)
      <select id="fld-rocks" multiple size="8">
        <option>Granite</option>
        <option>Basalt</option>
        <option>Rhyolite</option>
        <option>Andesite</option>
        <option>Diorite</option>
        <option>Gabbro</option>
        <option>Pegmatite</option>
        <option>Obsidian</option>
        <option>Sandstone</option>
        <option>Limestone</option>
        <option>Shale</option>
        <option>Conglomerate</option>
        <option>Breccia</option>
        <option>Chert</option>
        <option>Dolostone</option>
        <option>Slate</option>
        <option>Schist</option>
        <option>Gneiss</option>
        <option>Quartzite</option>
        <option>Marble</option>
        <option>Serpentinite</option>
        <option>Soapstone</option>
        <option>Unakite</option>
        <option>Banded Iron Formation</option>
      </select>
    </label>

    <label>Mineral composition
      <select id="fld-minerals" multiple size="10">
        <option>Quartz</option>
        <option>Feldspar</option>
        <option>Plagioclase</option>
        <option>Orthoclase</option>
        <option>Muscovite</option>
        <option>Biotite</option>
        <option>Amphibole</option>
        <option>Hornblende</option>
        <option>Pyroxene</option>
        <option>Augite</option>
        <option>Olivine</option>
        <option>Calcite</option>
        <option>Dolomite</option>
        <option>Hematite</option>
        <option>Magnetite</option>
        <option>Pyrite</option>
        <option>Chalcopyrite</option>
        <option>Fluorite</option>
        <option>Apatite</option>
        <option>Talc</option>
        <option>Gypsum</option>
        <option>Halite</option>
        <option>Kaolinite</option>
        <option>Garnet</option>
        <option>Epidote</option>
        <option>Tourmaline</option>
        <option>Beryl</option>
        <option>Corundum</option>
        <option>Kyanite</option>
      </select>
    </label>
  </div>

  <div class="grid-3">
    <label>Colour
      <input id="fld-colour" type="text" placeholder="grey with pink feldspar">
    </label>
    <label>Lustre
      <select id="fld-lustre">
        <option value="">—</option>
        <option>Metallic</option>
        <option>Submetallic</option>
        <option>Adamantine</option>
        <option>Subadamantine</option>
        <option>Vitreous</option>
        <option>Subvitreous</option>
        <option>Resinous</option>
        <option>Greasy</option>
        <option>Pearly</option>
        <option>Silky</option>
        <option>Waxy</option>
        <option>Dull (Earthy)</option>
      </select>
      <details class="help">
        <summary>What is lustre?</summary>
        How a fresh surface reflects light.
        <ul>
          <li>Metallic: looks like metal; opaque, high shine.</li>
          <li>Vitreous: glassy (quartz, many silicates).</li>
          <li>Resinous/Greasy/Waxy: plastic‑like or oily sheen.</li>
          <li>Pearly/Silky: layered or fibrous sheen.</li>
          <li>Dull/Earthy: little to no reflection.</li>
        </ul>
        Tip: test on a fresh break, not weathered surfaces.
      </details>
    </label>
    <label>Hardness (Mohs)
      <select id="fld-hardness">
        <option value="">—</option>
        <option>1 - Talc (scratched by fingernail)</option>
        <option>2 - Gypsum (fingernail scratches)</option>
        <option>3 - Calcite (scratched by copper)</option>
        <option>4 - Fluorite</option>
        <option>5 - Apatite</option>
        <option>6 - Orthoclase (scratches glass)</option>
        <option>7 - Quartz</option>
        <option>8 - Topaz</option>
        <option>9 - Corundum</option>
        <option>10 - Diamond</option>
      </select>
    </label>
    <label>Streak
      <select id="fld-streak">
        <option value="">—</option>
        <option>White</option>
        <option>Colourless</option>
        <option>Grey</option>
        <option>Black</option>
        <option>Brown</option>
        <option>Red</option>
        <option>Yellow</option>
        <option>Green</option>
        <option>Blue</option>
      </select>
    </label>
    <label>Cleavage
      <select id="fld-cleavage">
        <option value="">None</option>
        <option>Perfect</option>
        <option>Good</option>
        <option>Fair</option>
        <option>Poor</option>
        <option>Basal (1)</option>
        <option>Prismatic (2 at 90°)</option>
        <option>Prismatic (2 not at 90°)</option>
        <option>Cubic (3 at 90°)</option>
        <option>Rhombohedral (3 not at 90°)</option>
        <option>Octahedral (4)</option>
        <option>Dodecahedral (6)</option>
      </select>
      <details class="help">
        <summary>What is cleavage?</summary>
        Tendency to split along flat, parallel planes.
        <ul>
          <li>Quality: Perfect → Poor indicates how clean planes are.</li>
          <li>Directions: Basal(1), Prismatic(2), Cubic/Rhombohedral(3), Octahedral(4), Dodecahedral(6).</li>
        </ul>
        Tip: look for repeated, parallel flat faces on broken pieces.
      </details>
    </label>
    <label>Fracture
      <select id="fld-fracture">
        <option value="">—</option>
        <option>Conchoidal</option>
        <option>Subconchoidal</option>
        <option>Even</option>
        <option>Uneven</option>
        <option>Hackly</option>
        <option>Splintery</option>
        <option>Earthy</option>
      </select>
      <details class="help">
        <summary>What is fracture?</summary>
        How a mineral breaks when it doesn’t follow cleavage.
        <ul>
          <li>Conchoidal: curved, shell‑like (quartz, glass).</li>
          <li>Hackly: jagged, torn metal‑like.</li>
          <li>Splintery/Fibrous: sharp splinters or fibres.</li>
          <li>Even/Uneven/Earthy: relatively flat vs rough vs crumbly.</li>
        </ul>
      </details>
    </label>
  </div>

  <label style="display:block;margin-top:.5rem">Crystal form / Texture
    <input id="fld-cft" type="text" placeholder="e.g., granular; coarse-grained; equigranular">
  </label>

  <label style="display:block;margin-top:.5rem">Notes
    <textarea id="fld-notes" rows="6" placeholder="Observations, context, etc."></textarea>
  </label>

  <details style="margin-top:.5rem">
    <summary>Add gallery image</summary>
    <div class="grid-2" style="margin-top:.5rem">
      <label>Image path
        <input id="fld-gal-src" type="text" placeholder="/assets/field/YYYY/photo-2.jpg">
      </label>
      <label>Caption
        <input id="fld-gal-cap" type="text" placeholder="e.g., Fresh break showing conchoidal fracture">
      </label>
    </div>
  </details>

  <div class="actions">
    <button id="btn-gen-field" type="button">Generate Front Matter</button>
    <button id="btn-copy-field" type="button">Copy to clipboard</button>
  </div>
  <pre id="fld-output"></pre>

  <script src="https://cdn.jsdelivr.net/npm/exifr@7/dist/full.umd.js"></script>
  <script>
    (async function () {
      const el = document.getElementById('auth-status');
      try {
        const res = await fetch(window.location.pathname, { method: 'HEAD', cache: 'no-store' });
        if (res.status === 200) { el.textContent = "You're logged in."; el.classList.add('auth-ok'); }
        else if (res.status === 401) { el.textContent = 'Not authenticated. Reload to sign in.'; el.classList.add('auth-fail'); }
        else { el.textContent = 'Auth check returned status ' + res.status + '.'; }
      } catch (e) { el.textContent = 'Auth check failed.'; el.classList.add('auth-fail'); }
    })();

    function copyTpl(id) {
      const el = document.getElementById(id);
      if (!el) return;
      const text = el.textContent || el.innerText || '';
      navigator.clipboard.writeText(text).then(() => alert('Template copied to clipboard.')).catch(() => alert('Copy failed'));
    }

    // Helper functions
    function val(el) { return el && 'value' in el ? el.value : ''; }
    function selMultiValues(sel) { return Array.from(sel?.selectedOptions || []).map(o => o.value).filter(Boolean); }
    function yamlList(arr, indent) { if (!arr || !arr.length) return '[]'; const sp = ' '.repeat(indent || 0); return '\n' + arr.map(v => sp + '- ' + String(v)).join('\n'); }
    function esc(s) { return String(s || '').replace(/\"/g, '\\\"'); }

    async function exifFromFile(file) {
      if (!file) return null;
      try {
        const data = await exifr.parse(file);
        if (!data) return null;
        const lat = data.latitude ?? null;
        const lng = data.longitude ?? null;
        const dt = data.DateTimeOriginal || data.CreateDate || data.ModifyDate || null;
        return { lat, lng, dt };
      } catch (e) { console.warn('EXIF read failed', e); return null; }
    }

    const exifBtn = document.getElementById('btn-exif');
    if (exifBtn) {
      exifBtn.addEventListener('click', async () => {
        const f = document.getElementById('fld-photo-file').files?.[0];
        const status = document.getElementById('exif-status');
        status.textContent = 'Reading…';
        const info = await exifFromFile(f);
        if (info?.lat && info?.lng) {
          document.getElementById('fld-lat').value = String(info.lat.toFixed(6));
          document.getElementById('fld-lng').value = String(info.lng.toFixed(6));
        }
        if (info?.dt && !document.getElementById('fld-date').value) {
          try { const d = new Date(info.dt); const iso = new Date(d.getTime() - d.getTimezoneOffset()*60000).toISOString().slice(0,10); document.getElementById('fld-date').value = iso; } catch {}
        }
        status.textContent = info ? 'EXIF parsed' : 'No EXIF GPS found';
      });
    }

    function buildFieldYaml() {
      const title = val(document.getElementById('fld-title')) || 'Specimen title';
      const date = val(document.getElementById('fld-date')) || 'YYYY-MM-DD';
      const closeUp = val(document.getElementById('fld-photo-close'));
      const scale = val(document.getElementById('fld-photo-scale'));
      const lat = val(document.getElementById('fld-lat'));
      const lng = val(document.getElementById('fld-lng'));
      const locDesc = val(document.getElementById('fld-loc-desc'));
      const rocks = selMultiValues(document.getElementById('fld-rocks'));
      const minerals = selMultiValues(document.getElementById('fld-minerals'));
      const colour = val(document.getElementById('fld-colour'));
      const lustre = val(document.getElementById('fld-lustre'));
      const hardness = val(document.getElementById('fld-hardness'));
      const streak = val(document.getElementById('fld-streak'));
      const cleavage = val(document.getElementById('fld-cleavage'));
      const fracture = val(document.getElementById('fld-fracture'));
      const cft = val(document.getElementById('fld-cft'));
      const galSrc = val(document.getElementById('fld-gal-src'));
      const galCap = val(document.getElementById('fld-gal-cap'));

      const lines = [];
      lines.push('---');
      lines.push(`title: "${esc(title)}"`);
      lines.push('layout: field');
      lines.push(`date: ${date}`);
      if (closeUp) lines.push(`thumbnail: "${esc(closeUp)}"`);
      lines.push('images:');
      lines.push(`  close_up: "${esc(closeUp)}"`);
      lines.push(`  scale: "${esc(scale)}"`);
      if (lat || lng || locDesc) {
        lines.push('location:');
        if (lat) lines.push(`  lat: ${lat}`);
        if (lng) lines.push(`  lng: ${lng}`);
        if (locDesc) lines.push(`  description: "${esc(locDesc)}"`);
      } else {
        lines.push('location:');
        lines.push('  lat:');
        lines.push('  lng:');
        lines.push('  description: ""');
      }
      lines.push('rocks:' + yamlList(rocks, 2));
      lines.push('minerals:' + yamlList(minerals, 2));
      if (colour) lines.push(`colour: "${esc(colour)}"`);
      if (lustre) lines.push(`lustre: "${esc(lustre)}"`);
      if (hardness) lines.push(`hardness_mohs: "${esc(hardness)}"`);
      if (streak) lines.push(`streak: "${esc(streak)}"`);
      if (cft) lines.push(`crystal_form_texture: "${esc(cft)}"`);
      if (cleavage) lines.push(`cleavage: "${esc(cleavage)}"`);
      if (fracture) lines.push(`fracture: "${esc(fracture)}"`);
      if (galSrc) { lines.push('gallery:'); lines.push(`  - { src: "${esc(galSrc)}", caption: "${esc(galCap)}" }`); }
      else { lines.push('gallery: []'); }
      lines.push('---');
      const notes = val(document.getElementById('fld-notes'));
      lines.push('\n' + notes);
      return lines.join('\n');
    }

    const btnGen = document.getElementById('btn-gen-field');
    const btnCopy = document.getElementById('btn-copy-field');
    const out = document.getElementById('fld-output');
    if (btnGen && out) btnGen.addEventListener('click', () => { out.textContent = buildFieldYaml(); });
    if (btnCopy && out) btnCopy.addEventListener('click', async () => {
      const text = out.textContent || buildFieldYaml();
      try { await navigator.clipboard.writeText(text); alert('Copied.'); } catch (e) { alert('Copy failed'); }
    });

    // ---- Upload helpers ----
    function extFromType(t) { if (!t) return 'jpg'; if (t.includes('png')) return 'png'; if (t.includes('webp')) return 'webp'; return 'jpg'; }
    function slug(s) { return String(s||'').toLowerCase().trim().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'') || 'specimen'; }
    function todayYMD() { const d = new Date(); const pad=n=>String(n).padStart(2,'0'); return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`; }
    function yearFromInput() { const v = val(document.getElementById('fld-date')); return (v && /^\d{4}/.test(v)) ? v.slice(0,4) : String(new Date().getFullYear()); }
    function buildDestPath(kind, file) {
      const y = yearFromInput();
      const base = 'assets/field/' + y + '/';
      const d = (val(document.getElementById('fld-date')) || todayYMD()).replace(/-/g,'');
      const title = val(document.getElementById('fld-title'));
      const name = `${d}-${slug(title)}-${kind}.${extFromType(file?.type)}`;
      return base + name;
    }
    function fileToBase64(file) { return new Promise((res, rej) => { const fr = new FileReader(); fr.onerror = () => rej(new Error('read failed')); fr.onload = () => { const s = String(fr.result||''); const idx = s.indexOf('base64,'); res(idx>=0 ? s.slice(idx+7) : s); }; fr.readAsDataURL(file); }); }
    async function uploadAsset(file, kind) {
      if (!file) throw new Error('No file selected');
      const pathInputId = kind === 'close-up' ? 'fld-photo-close' : 'fld-photo-scale';
      let dest = val(document.getElementById(pathInputId)).replace(/^\//,'');
      if (!dest) dest = buildDestPath(kind, file);
      const body = { path: dest, content_base64: await fileToBase64(file), message: `Upload field ${kind}` };
      const resp = await fetch('/.netlify/functions/upload-asset', { method:'POST', headers: { 'content-type':'application/json' }, body: JSON.stringify(body), credentials: 'include' });
      if (!resp.ok) {
        const txt = await resp.text();
        throw new Error(`Upload failed (${resp.status}): ${txt}`);
      }
      const data = await resp.json();
      const fullPath = '/' + data.path.replace(/^\//,'');
      document.getElementById(pathInputId).value = fullPath;
      return fullPath;
    }

    function setStatus(el, msg, ok) {
      if (!el) return;
      el.classList.remove('auth-ok', 'auth-fail');
      // Clear previous content
      while (el.firstChild) el.removeChild(el.firstChild);
      if (ok === true) {
        // Inline SVG check icon
        const ns = 'http://www.w3.org/2000/svg';
        const svg = document.createElementNS(ns, 'svg');
        svg.setAttribute('viewBox', '0 0 16 16');
        svg.setAttribute('fill', 'none');
        svg.setAttribute('stroke', 'currentColor');
        svg.setAttribute('stroke-width', '2');
        svg.setAttribute('aria-hidden', 'true');
        const path = document.createElementNS(ns, 'path');
        path.setAttribute('d', 'M3 8l3 3 7-7');
        svg.appendChild(path);
        el.appendChild(svg);
        el.classList.add('auth-ok');
      } else if (ok === false) {
        el.classList.add('auth-fail');
      }
      el.appendChild(document.createTextNode(msg));
    }
    document.getElementById('btn-upload-close')?.addEventListener('click', async () => {
      const st = document.getElementById('status-upload-close');
      setStatus(st, 'Uploading…');
      try {
        const f = document.getElementById('fld-file-close').files?.[0];
        const p = await uploadAsset(f, 'close-up');
        setStatus(st, 'Saved to ' + p, true);
      } catch (e) {
        setStatus(st, (e?.message || 'Upload failed'), false);
      }
    });
    document.getElementById('btn-upload-scale')?.addEventListener('click', async () => {
      const st = document.getElementById('status-upload-scale');
      setStatus(st, 'Uploading…');
      try {
        const f = document.getElementById('fld-file-scale').files?.[0];
        const p = await uploadAsset(f, 'with-scale');
        setStatus(st, 'Saved to ' + p, true);
      } catch (e) {
        setStatus(st, (e?.message || 'Upload failed'), false);
      }
    });
  </script>

  <!-- Template for quick copy -->
  <script type="text/plain" id="tpl-field-log">{% raw %}---
title: "Specimen title"
layout: field
date: YYYY-MM-DD
thumbnail: "" # optional; will fall back to images.close_up
images:
  close_up: "/assets/field/YYYY/close-up.jpg"
  scale: "" # optional
location:
  lat: 
  lng: 
  description: "" # optional human-readable location
rocks: []
minerals: []
colour: ""
lustre: ""
hardness_mohs: ""
streak: ""
crystal_form_texture: ""
cleavage: ""
fracture: ""
gallery: [] # e.g., - { src: "/assets/field/YYYY/another.jpg", caption: "Fresh break" }
---

<!-- Notes go here. You can also add a 'gallery' array in front matter. -->
{% endraw %}</script>

</body>
</html>
