---
layout: none
title: Admin
permalink: /admin/
---
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin</title>
  <style>
    body { font-family: sans-serif; max-width: 48rem; margin: 2rem auto; }
    h1 { margin-bottom: .5rem; }
    .auth-status { font-size: .95rem; margin: .25rem 0 1rem; color: #666; }
    .auth-ok { color: #2e7d32; }
    .auth-fail { color: #c62828; }
    .cards { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 1rem; }
    .card { border: 1px solid #ddd; border-radius: 8px; padding: 1rem; }
    .card h2 { margin: 0 0 .5rem 0; font-size: 1.1rem; }
  </style>
  {% assign css_v = site.time | date: '%s' %}
  <link rel="stylesheet" href="{{ '/styles.css' | relative_url }}?v={{ css_v }}">
  <meta name="robots" content="noindex, nofollow">
  <!-- Page is now protected by Netlify Basic Auth via netlify.toml -->
  <!-- The previous client-side login has been removed. -->
</head>
<body>
  <h1>Admin</h1>
  <p>Welcome. This area is protected by Basic Auth at the edge.</p>
  <p id="auth-status" class="auth-status">Checking authentication…</p>

  <div class="cards">
    <div class="card">
      <h2>Field Log</h2>
      <p>Create and populate a field identification log with images and properties.</p>
      <p>
        <button onclick="copyTpl('tpl-field-log')">Copy Field Log Template</button>
        <a href="https://github.com/Chantal13/Spectrum-Syntax/new/main/_notes/rockhounding/field-log?filename=YYYY-MM-DD-title.md" target="_blank" rel="noopener noreferrer">New file in GitHub</a>
      </p>

      <details>
        <summary><strong>Helper: Build front matter + extract EXIF location</strong></summary>
        <div style="margin-top:.5rem">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:.5rem;align-items:end;">
            <label>Title
              <input id="fld-title" type="text" placeholder="e.g., Granite with Quartz Vein" style="width:100%">
            </label>
            <label>Date
              <input id="fld-date" type="date" style="width:100%">
            </label>

            <label>Close-up photo path
              <input id="fld-photo-close" type="text" placeholder="/assets/field/YYYY/close-up.jpg" style="width:100%">
            </label>
            <label>Scale photo path (optional)
              <input id="fld-photo-scale" type="text" placeholder="/assets/field/YYYY/with-scale.jpg" style="width:100%">
            </label>

            <label>Pick a photo to read EXIF GPS
              <input id="fld-photo-file" type="file" accept="image/*" style="width:100%">
            </label>
            <div>
              <button type="button" id="btn-exif">Extract GPS</button>
              <span id="exif-status" style="margin-left:.5rem;color:#666"></span>
            </div>

            <label>Latitude
              <input id="fld-lat" type="text" placeholder="43.6532" style="width:100%">
            </label>
            <label>Longitude
              <input id="fld-lng" type="text" placeholder="-79.3832" style="width:100%">
            </label>
          </div>

          <label style="display:block;margin-top:.5rem">Location description
            <input id="fld-loc-desc" type="text" placeholder="Bluffers Park shoreline, Scarborough" style="width:100%">
          </label>

          <div style="display:grid;grid-template-columns:1fr 1fr;gap:.5rem;margin-top:.5rem">
            <label>Rock type(s)
              <select id="fld-rocks" multiple size="6" style="width:100%">
                <option>Granite</option>
                <option>Basalt</option>
                <option>Rhyolite</option>
                <option>Andesite</option>
                <option>Diorite</option>
                <option>Gabbro</option>
                <option>Pegmatite</option>
                <option>Obsidian</option>
                <option>Sandstone</option>
                <option>Limestone</option>
                <option>Shale</option>
                <option>Conglomerate</option>
                <option>Breccia</option>
                <option>Chert</option>
                <option>Dolostone</option>
                <option>Slate</option>
                <option>Schist</option>
                <option>Gneiss</option>
                <option>Quartzite</option>
                <option>Marble</option>
                <option>Serpentinite</option>
                <option>Soapstone</option>
                <option>Unakite</option>
                <option>Banded Iron Formation</option>
              </select>
            </label>

            <label>Mineral composition
              <select id="fld-minerals" multiple size="8" style="width:100%">
                <option>Quartz</option>
                <option>Feldspar</option>
                <option>Plagioclase</option>
                <option>Orthoclase</option>
                <option>Muscovite</option>
                <option>Biotite</option>
                <option>Amphibole</option>
                <option>Hornblende</option>
                <option>Pyroxene</option>
                <option>Augite</option>
                <option>Olivine</option>
                <option>Calcite</option>
                <option>Dolomite</option>
                <option>Hematite</option>
                <option>Magnetite</option>
                <option>Pyrite</option>
                <option>Chalcopyrite</option>
                <option>Fluorite</option>
                <option>Apatite</option>
                <option>Talc</option>
                <option>Gypsum</option>
                <option>Halite</option>
                <option>Kaolinite</option>
                <option>Garnet</option>
                <option>Epidote</option>
                <option>Tourmaline</option>
                <option>Beryl</option>
                <option>Corundum</option>
                <option>Kyanite</option>
              </select>
            </label>
          </div>

          <div style="display:grid;grid-template-columns:1fr 1fr;gap:.5rem;margin-top:.5rem">
            <label>Colour
              <input id="fld-colour" type="text" placeholder="grey with pink feldspar" style="width:100%">
            </label>
            <label>Lustre
              <select id="fld-lustre" style="width:100%">
                <option value="">—</option>
                <option>Metallic</option>
                <option>Submetallic</option>
                <option>Adamantine</option>
                <option>Subadamantine</option>
                <option>Vitreous</option>
                <option>Subvitreous</option>
                <option>Resinous</option>
                <option>Greasy</option>
                <option>Pearly</option>
                <option>Silky</option>
                <option>Waxy</option>
                <option>Dull (Earthy)</option>
              </select>
            </label>

            <label>Hardness (Mohs)
              <select id="fld-hardness" style="width:100%">
                <option value="">—</option>
                <option>1 - Talc (scratched by fingernail)</option>
                <option>2 - Gypsum (fingernail scratches)</option>
                <option>3 - Calcite (scratched by copper)</option>
                <option>4 - Fluorite</option>
                <option>5 - Apatite</option>
                <option>6 - Orthoclase (scratches glass)</option>
                <option>7 - Quartz</option>
                <option>8 - Topaz</option>
                <option>9 - Corundum</option>
                <option>10 - Diamond</option>
              </select>
            </label>

            <label>Streak
              <select id="fld-streak" style="width:100%">
                <option value="">—</option>
                <option>White</option>
                <option>Colorless</option>
                <option>Gray</option>
                <option>Black</option>
                <option>Brown</option>
                <option>Red</option>
                <option>Yellow</option>
                <option>Green</option>
                <option>Blue</option>
              </select>
            </label>

            <label>Cleavage
              <select id="fld-cleavage" style="width:100%">
                <option value="">None</option>
                <option>Perfect</option>
                <option>Good</option>
                <option>Fair</option>
                <option>Poor</option>
                <option>Basal (1)</option>
                <option>Prismatic (2 at 90°)</option>
                <option>Prismatic (2 not at 90°)</option>
                <option>Cubic (3 at 90°)</option>
                <option>Rhombohedral (3 not at 90°)</option>
                <option>Octahedral (4)</option>
                <option>Dodecahedral (6)</option>
              </select>
            </label>

            <label>Fracture
              <select id="fld-fracture" style="width:100%">
                <option value="">—</option>
                <option>Conchoidal</option>
                <option>Subconchoidal</option>
                <option>Even</option>
                <option>Uneven</option>
                <option>Hackly</option>
                <option>Splintery</option>
                <option>Earthy</option>
              </select>
            </label>
          </div>

          <label style="display:block;margin-top:.5rem">Crystal form / Texture
            <input id="fld-cft" type="text" placeholder="e.g., granular; coarse-grained; equigranular" style="width:100%">
          </label>

          <label style="display:block;margin-top:.5rem">Notes
            <textarea id="fld-notes" rows="4" placeholder="Observations, context, etc." style="width:100%"></textarea>
          </label>

          <details style="margin-top:.5rem">
            <summary>Add gallery image</summary>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:.5rem;margin-top:.5rem">
              <label>Image path
                <input id="fld-gal-src" type="text" placeholder="/assets/field/YYYY/photo-2.jpg" style="width:100%">
              </label>
              <label>Caption
                <input id="fld-gal-cap" type="text" placeholder="e.g., Fresh break showing conchoidal fracture" style="width:100%">
              </label>
            </div>
          </details>

          <div style="margin-top:.75rem">
            <button id="btn-gen-field" type="button">Generate Front Matter</button>
            <button id="btn-copy-field" type="button">Copy to clipboard</button>
          </div>
          <pre id="fld-output" style="white-space:pre-wrap;background:#f7f7f7;border:1px solid #ddd;padding:.5rem;margin-top:.5rem"></pre>
        </div>
      </details>
    </div>

    <div class="card">
      <h2>Tumbling Log Checklist</h2>
      <p>Run through the pre‑publish checks for each batch.</p>
      <p><a class="internal-link" href="{{ '/admin/tumbling/log-checklist/' | relative_url }}">Open checklist</a></p>
    </div>

    <div class="card">
      <h2>Admin Guide</h2>
      <p>How to use and secure the admin tools.</p>
      <p><a class="internal-link" href="{{ '/admin/guide/' | relative_url }}">Read guide</a></p>
    </div>

    <div class="card">
      <h2>Tools</h2>
      <p>Quick links to common sections.</p>
      <ul>
        <li><a class="internal-link" href="{{ '/rockhounding/' | relative_url }}">Rockhounding</a></li>
        <li><a class="internal-link" href="{{ '/rockhounding/rocks/' | relative_url }}">Rocks &amp; Minerals</a></li>
        <li><a class="internal-link" href="{{ '/rockhounding/field-log/' | relative_url }}">Field Log</a></li>
        <li><a class="internal-link" href="{{ '/logs/' | relative_url }}">Logs</a></li>
        <li><a class="internal-link" href="{{ '/tumbling/' | relative_url }}">Tumbling</a></li>
        <li><a class="internal-link" href="{{ '/rockhounding/guides/' | relative_url }}">Guides</a></li>
        <li><a class="internal-link" href="{{ '/hobbies/' | relative_url }}">Hobbies</a></li>
        <li><a class="internal-link" href="{{ '/blog/' | relative_url }}">Blog</a></li>
        <li><a class="internal-link" href="{{ '/about' | relative_url }}">About</a></li>
        <li><a href="https://app.netlify.com/sites/spectrumsyntax/deploys" target="_blank" rel="noopener noreferrer">Netlify Deploys</a></li>
        <li><a href="https://github.com/Chantal13/Spectrum-Syntax/pulls" target="_blank" rel="noopener noreferrer">GitHub PRs</a></li>
      </ul>
    </div>

    <div class="card">
      <h2>Editing Shortcuts</h2>
      <p>Jump straight to GitHub edit pages for common files.</p>
      <ul>
        <li><a href="https://github.com/Chantal13/Spectrum-Syntax/edit/main/_pages/index.md" target="_blank" rel="noopener noreferrer">Edit Homepage</a></li>
        <li><a href="https://github.com/Chantal13/Spectrum-Syntax/edit/main/_pages/rockhounding/index.md" target="_blank" rel="noopener noreferrer">Edit Rockhounding Index</a></li>
        <li><a href="https://github.com/Chantal13/Spectrum-Syntax/edit/main/_pages/rockhounding/rocks/index.md" target="_blank" rel="noopener noreferrer">Edit Rocks &amp; Minerals Index</a></li>
        <li><a href="https://github.com/Chantal13/Spectrum-Syntax/edit/main/_pages/rockhounding/field-log/index.md" target="_blank" rel="noopener noreferrer">Edit Field Log Index</a></li>
        <li><a href="https://github.com/Chantal13/Spectrum-Syntax/edit/main/_pages/logs/index.md" target="_blank" rel="noopener noreferrer">Edit Logs Page</a></li>
        <li><a href="https://github.com/Chantal13/Spectrum-Syntax/edit/main/_pages/tumbling/index.md" target="_blank" rel="noopener noreferrer">Edit Tumbling Index</a></li>
        <li><a href="https://github.com/Chantal13/Spectrum-Syntax/edit/main/_pages/rockhounding/guides/index.md" target="_blank" rel="noopener noreferrer">Edit Guides Index</a></li>
        <li><a href="https://github.com/Chantal13/Spectrum-Syntax/edit/main/_includes/notes_graph.html" target="_blank" rel="noopener noreferrer">Edit Notes Graph include</a></li>
        <li><a href="https://github.com/Chantal13/Spectrum-Syntax/edit/main/_includes/rock-card.html" target="_blank" rel="noopener noreferrer">Edit Rock Card include</a></li>
        <li><a href="https://github.com/Chantal13/Spectrum-Syntax/edit/main/_includes/breadcrumbs.html" target="_blank" rel="noopener noreferrer">Edit Breadcrumbs include</a></li>
        <li><a href="https://github.com/Chantal13/Spectrum-Syntax/edit/main/_admin/admin-guide.md" target="_blank" rel="noopener noreferrer">Edit Admin Guide</a></li>
      </ul>
      <p>Browse notes folders:</p>
      <ul>
        <li><a href="https://github.com/Chantal13/Spectrum-Syntax/tree/main/_notes/rockhounding" target="_blank" rel="noopener noreferrer">_notes/rockhounding</a></li>
        <li><a href="https://github.com/Chantal13/Spectrum-Syntax/tree/main/_notes/rockhounding/rocks/minerals" target="_blank" rel="noopener noreferrer">_notes/rockhounding/rocks/minerals</a></li>
      </ul>
    </div>

    <div class="card">
      <h2>Dev Shortcuts</h2>
      <p>Repo/config and automation quick links.</p>
      <ul>
        <li><a href="https://github.com/Chantal13/Spectrum-Syntax/edit/main/_config.yml" target="_blank" rel="noopener noreferrer">Edit _config.yml</a></li>
        <li><a href="https://github.com/Chantal13/Spectrum-Syntax/edit/main/netlify.toml" target="_blank" rel="noopener noreferrer">Edit netlify.toml</a></li>
        <li><a href="https://github.com/Chantal13/Spectrum-Syntax/edit/main/netlify/edge-functions/admin-auth.js" target="_blank" rel="noopener noreferrer">Edit admin-auth edge function</a></li>
        <li><a href="https://github.com/Chantal13/Spectrum-Syntax/edit/main/.github/workflows/linkcheck.yml" target="_blank" rel="noopener noreferrer">Edit Link Check workflow</a></li>
        <li><a href="https://github.com/Chantal13/Spectrum-Syntax/actions/workflows/linkcheck.yml" target="_blank" rel="noopener noreferrer">View Link Check runs</a></li>
        <li><a href="https://github.com/Chantal13/Spectrum-Syntax/new/main/_notes/rockhounding" target="_blank" rel="noopener noreferrer">New note in _notes/rockhounding</a></li>
        <li><a href="https://github.com/Chantal13/Spectrum-Syntax/new/main/_notes/rockhounding/rocks/minerals" target="_blank" rel="noopener noreferrer">New mineral note</a></li>
      </ul>
    </div>

    <div class="card">
      <h2>New Note Templates</h2>
      <p>Copy a template, then use the “New…” links to create a file and paste.</p>
      <p>
        <button type="button" onclick="copyTpl('tpl-mineral')">Copy Mineral Template</button>
        <a href="https://github.com/Chantal13/Spectrum-Syntax/new/main/_notes/rockhounding/rocks/minerals?filename=mineral-name.md" target="_blank" rel="noopener noreferrer">New mineral note</a>
      </p>
      <p>
        <button type="button" onclick="copyTpl('tpl-rock')">Copy Rock Template</button>
        <a href="https://github.com/Chantal13/Spectrum-Syntax/new/main/_notes/rockhounding/rocks/igneous?filename=rock-name.md" target="_blank" rel="noopener noreferrer">New igneous rock</a>
        ·
        <a href="https://github.com/Chantal13/Spectrum-Syntax/new/main/_notes/rockhounding/rocks/metamorphic?filename=rock-name.md" target="_blank" rel="noopener noreferrer">New metamorphic rock</a>
        ·
        <a href="https://github.com/Chantal13/Spectrum-Syntax/new/main/_notes/rockhounding/rocks/sedimentary?filename=rock-name.md" target="_blank" rel="noopener noreferrer">New sedimentary rock</a>
      </p>
      <p>
        <button type="button" onclick="copyTpl('tpl-tumble')">Copy Tumbling Batch Template</button>
        <a href="https://github.com/Chantal13/Spectrum-Syntax/new/main/_notes/rockhounding/tumbling?filename=YYYY-MM-DD-batch-000.md" target="_blank" rel="noopener noreferrer">New tumbling batch</a>
      </p>

      <script type="text/plain" id="tpl-mineral">{% raw %}---
title: Mineral Name
tags:
  - rockhounding
aliases: []
thumbnail: "/assets/tumbling/placeholder.jpg"
hardness: 7
luster: null
streak: null
---
{% include rock-card.html rock=page %}

## Overview
Brief description of the mineral, where it appears locally, and any notable field traits.

## Appearance & Identification
- Colour:
- Luster:
- Transparency:
- Crystal Habit:
- Hardness: [[Mohs Hardness Scale|Mohs]] X–Y

## Tumbling Qualities
- Hardness: [[Mohs Hardness Scale|Mohs]] X–Y
- Notes:

## Related
- [[igneous|Igneous Rocks]] · [[sedimentary|Sedimentary Rocks]] · [[metamorphic|Metamorphic Rocks]]
{% endraw %}</script>

      <script type="text/plain" id="tpl-rock">{% raw %}---
title: Rock Name (Family)
tags:
  - rockhounding
aliases: []
thumbnail: "/assets/rocks/placeholder.jpg"
---

## Overview
One-paragraph description of the rock, typical composition, and where to find it locally.

## Appearance & Identification
- Texture:
- Colours:
- Minerals: [[quartz]], [[feldspar]], ...
- Key tells:

## Tumbling Notes
- Hardness: [[Mohs Hardness Scale|Mohs]] X–Y
- Tips:

## Related
- [[igneous|Igneous Rocks]] · [[sedimentary|Sedimentary Rocks]] · [[metamorphic|Metamorphic Rocks]]
{% endraw %}</script>

      <script type="text/plain" id="tpl-tumble">{% raw %}---
title: "Batch Title"
batch: "000"
status: "In Progress"
date_started: "YYYY-MM-DD"
date_finished: ""
tumbler: "National Geographic Professional Rock Tumbler"
origin: ""
consumables_brand: "National Geographic"
rocks:
  - agate
  - jasper
images:
  rough: "/assets/tumbling/000/rough-000.jpg"
  after_stage_1: "/assets/tumbling/000/after-s1-000.jpg"
  after_stage_3: "/assets/tumbling/000/after-s3-000.jpg"
  after_stage_4: "/assets/tumbling/000/after-s4-000.jpg"
notes: "Short summary and goals for this batch."
stages:
  - stage: 1
    name: "Coarse Grind"
    start: "YYYY-MM-DD"
    end: ""
    grit: "60/90 SiC"
    amount_tbsp: 2
    barrel_fill_pct: "75%"
    water_level: "Just below top layer"
    media_used: "None"
    maintenance: ""
    observations: ""
    decision:
      repeat: "no"
      why: ""

  - stage: 2
    name: "Medium Grind"
    grit: "120/220 SiC"
    amount_tbsp: 2
    barrel_fill_pct: ""
    water_level: "Just below top layer"
    media_used: ""
    maintenance: ""
    observations: ""

  - stage: 3
    name: "Pre-Polish"
    grit: "500 SiC"
    amount_tbsp: 2
    barrel_fill_pct: ""
    water_level: "Just below top layer"
    media_used: ""
    maintenance: ""
    observations: ""

  - stage: 4
    name: "Polish"
    end: "YYYY-MM-DD"
    polish: "Aluminum Oxide (TXP)"
    amount_tbsp: 2
    barrel_fill_pct: ""
    water_level: "Just below top layer; clean water"
    media_used: ""
    maintenance: ""
    observations: ""
---

<!-- Add batch narrative here if desired. -->
{% endraw %}</script>

      <script type="text/plain" id="tpl-field-log">{% raw %}---
title: "Specimen title"
layout: field
date: YYYY-MM-DD
thumbnail: "" # optional; will fall back to images.close_up
images:
  close_up: "/assets/field/YYYY/close-up.jpg"
  scale: "" # optional
location:
  lat: 
  lng: 
  description: "" # optional human-readable location
rocks: []
minerals: []
colour: ""
lustre: ""
hardness_mohs: ""
streak: ""
crystal_form_texture: ""
cleavage: ""
fracture: ""
gallery: [] # e.g., - { src: "/assets/field/YYYY/another.jpg", caption: "Fresh break" }
---

<!-- Notes go here. You can also add a 'gallery' array in front matter. -->
{% endraw %}</script>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/exifr@7/dist/full.umd.js"></script>
  <script>
    (async function () {
      const el = document.getElementById('auth-status');
      try {
        const res = await fetch(window.location.pathname, { method: 'HEAD', cache: 'no-store' });
        if (res.status === 200) {
          el.textContent = "You're logged in.";
          el.classList.add('auth-ok');
        } else if (res.status === 401) {
          el.textContent = 'Not authenticated. Reload to sign in.';
          el.classList.add('auth-fail');
        } else {
          el.textContent = 'Auth check returned status ' + res.status + '.';
        }
      } catch (e) {
        el.textContent = 'Auth check failed.';
        el.classList.add('auth-fail');
      }
    })();
    async function copyTpl(id) {
      const el = document.getElementById(id);
      if (!el) return;
      const text = el.textContent || el.innerText || '';
      try {
        await navigator.clipboard.writeText(text);
        alert('Template copied to clipboard.');
      } catch (e) {
        const ta = document.createElement('textarea');
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
        alert('Template copied to clipboard.');
      }
    }

    // ---------- Field Log helper ----------
    function val(el) { return el && 'value' in el ? el.value : ''; }
    function selMultiValues(sel) {
      return Array.from(sel?.selectedOptions || []).map(o => o.value).filter(Boolean);
    }
    function yamlList(arr, indent) {
      if (!arr || !arr.length) return '[]';
      const sp = ' '.repeat(indent || 0);
      return '\n' + arr.map(v => sp + '- ' + String(v)).join('\n');
    }
    function esc(s) { return String(s || '').replace(/"/g, '\\"'); }

    async function exifFromFile(file) {
      if (!file) return null;
      try {
        const data = await exifr.parse(file);
        if (!data) return null;
        const lat = data.latitude ?? null;
        const lng = data.longitude ?? null;
        const dt = data.DateTimeOriginal || data.CreateDate || data.ModifyDate || null;
        return { lat, lng, dt };
      } catch (e) {
        console.warn('EXIF read failed', e);
        return null;
      }
    }

    const exifBtn = document.getElementById('btn-exif');
    if (exifBtn) {
      exifBtn.addEventListener('click', async () => {
        const f = document.getElementById('fld-photo-file').files?.[0];
        const status = document.getElementById('exif-status');
        status.textContent = 'Reading…';
        const info = await exifFromFile(f);
        if (info?.lat && info?.lng) {
          document.getElementById('fld-lat').value = String(info.lat.toFixed(6));
          document.getElementById('fld-lng').value = String(info.lng.toFixed(6));
        }
        if (info?.dt && !document.getElementById('fld-date').value) {
          try {
            const d = new Date(info.dt);
            const iso = new Date(d.getTime() - d.getTimezoneOffset()*60000).toISOString().slice(0,10);
            document.getElementById('fld-date').value = iso;
          } catch {}
        }
        status.textContent = info ? 'EXIF parsed' : 'No EXIF GPS found';
      });
    }

    function buildFieldYaml() {
      const title = val(document.getElementById('fld-title')) || 'Specimen title';
      const date = val(document.getElementById('fld-date')) || 'YYYY-MM-DD';
      const closeUp = val(document.getElementById('fld-photo-close'));
      const scale = val(document.getElementById('fld-photo-scale'));
      const lat = val(document.getElementById('fld-lat'));
      const lng = val(document.getElementById('fld-lng'));
      const locDesc = val(document.getElementById('fld-loc-desc'));
      const rocks = selMultiValues(document.getElementById('fld-rocks'));
      const minerals = selMultiValues(document.getElementById('fld-minerals'));
      const colour = val(document.getElementById('fld-colour'));
      const lustre = val(document.getElementById('fld-lustre'));
      const hardness = val(document.getElementById('fld-hardness'));
      const streak = val(document.getElementById('fld-streak'));
      const cleavage = val(document.getElementById('fld-cleavage'));
      const fracture = val(document.getElementById('fld-fracture'));
      const cft = val(document.getElementById('fld-cft'));
      const galSrc = val(document.getElementById('fld-gal-src'));
      const galCap = val(document.getElementById('fld-gal-cap'));

      const lines = [];
      lines.push('---');
      lines.push(`title: "${esc(title)}"`);
      lines.push('layout: field');
      lines.push(`date: ${date}`);
      if (closeUp) lines.push(`thumbnail: "${esc(closeUp)}"`);
      lines.push('images:');
      lines.push(`  close_up: "${esc(closeUp)}"`);
      lines.push(`  scale: "${esc(scale)}"`);
      if (lat || lng || locDesc) {
        lines.push('location:');
        if (lat) lines.push(`  lat: ${lat}`);
        if (lng) lines.push(`  lng: ${lng}`);
        if (locDesc) lines.push(`  description: "${esc(locDesc)}"`);
      } else {
        lines.push('location:');
        lines.push('  lat:');
        lines.push('  lng:');
        lines.push('  description: ""');
      }
      lines.push('rocks:' + yamlList(rocks, 2));
      lines.push('minerals:' + yamlList(minerals, 2));
      if (colour) lines.push(`colour: "${esc(colour)}"`);
      if (lustre) lines.push(`lustre: "${esc(lustre)}"`);
      if (hardness) lines.push(`hardness_mohs: "${esc(hardness)}"`);
      if (streak) lines.push(`streak: "${esc(streak)}"`);
      if (cft) lines.push(`crystal_form_texture: "${esc(cft)}"`);
      if (cleavage) lines.push(`cleavage: "${esc(cleavage)}"`);
      if (fracture) lines.push(`fracture: "${esc(fracture)}"`);
      if (galSrc) {
        lines.push('gallery:');
        lines.push(`  - { src: "${esc(galSrc)}", caption: "${esc(galCap)}" }`);
      } else {
        lines.push('gallery: []');
      }
      lines.push('---');
      const notes = val(document.getElementById('fld-notes'));
      lines.push('\n' + notes);
      return lines.join('\n');
    }

    const btnGen = document.getElementById('btn-gen-field');
    const btnCopy = document.getElementById('btn-copy-field');
    const out = document.getElementById('fld-output');
    if (btnGen && out) btnGen.addEventListener('click', () => { out.textContent = buildFieldYaml(); });
    if (btnCopy && out) btnCopy.addEventListener('click', async () => {
      const text = out.textContent || buildFieldYaml();
      try { await navigator.clipboard.writeText(text); alert('Copied.'); } catch (e) { alert('Copy failed'); }
    });
  </script>
</body>
</html>
